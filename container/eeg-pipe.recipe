Bootstrap: docker
From: continuumio/miniconda3

%help

	.__   __.  _______   ______  __          ___      .______   
	|  \ |  | |       \ /      ||  |        /   \     |   _  \  
	|   \|  | |  .--.  |  ,----'|  |       /  ^  \    |  |_)  | 
	|  . `  | |  |  |  |  |     |  |      /  /_\  \   |   _  <  
	|  |\   | |  '--'  |  `----.|  `----./  _____  \  |  |_)  | 
	|__| \__| |_______/ \______||_______/__/     \__\ |______/  
                                                            
	Start this container to reliably run the base-eeg pipeline with all
	necessary packages, environments, and libraries. 

	Usage:
	
	To start a shell instance with the container image, execute
		
		singularity shell container/pipe-env.simg

	To execute a command within the container, execute:
		
		singularity exec container/pipe-env.simg [command]

	Lastly, to create an instance of the container that runs in the 
	background, execute:

		singularity instance start container/pipe-env.simg [name]

%files
	
	environment.yml

%post
       
	# update package repository list
        apt-get -y update
	
	# download base software
	apt-get -y upgrade bash-completion \
	 build-essential \
	 curl \
	 git git-core \
	 golang \
	 htop \
	 locales \
	 man \
	 nmap \
	 python3-pip \
	 ruby-full \
	 strace \
	 sudo \
	 tig \
	 vim \
	 wget

	# set time
	locale-gen en_US.UTF-8
	
	# create a conda environent using the yml file
	/opt/conda/bin/conda env create	-f environment.yml
	
	# list the available conda environments
	/opt/conda/bin/conda env list

%runscript
	
	# activate the environment
	source /opt/conda/bin/activate $(head -n 1 container/environment.yml | cut -f 2 -d ' ')
